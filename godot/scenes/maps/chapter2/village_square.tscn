[gd_scene load_steps=4 format=3 uid="uid://village_square_map"]

[ext_resource type="Script" path="res://scripts/map/map_data.gd" id="1_mapdata"]
[ext_resource type="Script" path="res://scripts/events/event_trigger.gd" id="2_trigger"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_npc"]
size = Vector2(80, 80)

[node name="VillageSquare" type="Node2D"]

[node name="MapData" type="Node" parent="."]
script = ExtResource("1_mapdata")
map_id = "village_square"
map_name = "마을 광장"
chapter = 2
map_width = 1600
map_height = 1000
map_type = "Town"
connections = {"exit_north": {"map": "res://scenes/maps/chapter2/training_grounds.tscn", "spawn": "from_village"}, "exit_east": {"map": "res://scenes/maps/chapter2/mercenary_guild.tscn", "spawn": "from_village"}}
entry_events = ["chapter2_start"]

[node name="Background" type="ColorRect" parent="."]
offset_right = 1600.0
offset_bottom = 1000.0
color = Color(0.4, 0.5, 0.35, 1)

[node name="Fountain" type="ColorRect" parent="."]
offset_left = 700.0
offset_top = 400.0
offset_right = 900.0
offset_bottom = 600.0
color = Color(0.3, 0.5, 0.7, 1)

[node name="Shop" type="ColorRect" parent="."]
offset_left = 200.0
offset_top = 200.0
offset_right = 400.0
offset_bottom = 400.0
color = Color(0.6, 0.45, 0.3, 1)

[node name="Inn" type="ColorRect" parent="."]
offset_left = 1200.0
offset_top = 200.0
offset_right = 1450.0
offset_bottom = 450.0
color = Color(0.55, 0.4, 0.35, 1)

[node name="Road" type="ColorRect" parent="."]
offset_left = 100.0
offset_top = 450.0
offset_right = 1500.0
offset_bottom = 550.0
color = Color(0.5, 0.45, 0.4, 1)

[node name="SpawnPoints" type="Node2D" parent="."]

[node name="default" type="Marker2D" parent="SpawnPoints"]
position = Vector2(800, 700)

[node name="from_chapter1" type="Marker2D" parent="SpawnPoints"]
position = Vector2(200, 500)

[node name="from_training" type="Marker2D" parent="SpawnPoints"]
position = Vector2(800, 200)

[node name="from_guild" type="Marker2D" parent="SpawnPoints"]
position = Vector2(1400, 500)

[node name="NPCs" type="Node2D" parent="."]

[node name="Merchant" type="Marker2D" parent="NPCs"]
position = Vector2(300, 450)
metadata/npc_id = "merchant"
metadata/dialogue = "res://resources/dialogues/chapter2/merchant_encounter.tres"

[node name="Elder" type="Marker2D" parent="NPCs"]
position = Vector2(900, 500)
metadata/npc_id = "elder"
metadata/dialogue = "res://resources/dialogues/chapter2/chapter2_start.tres"

[node name="Triggers" type="Node2D" parent="."]

[node name="ChapterStartTrigger" type="Area2D" parent="Triggers"]
position = Vector2(800, 600)
script = ExtResource("2_trigger")
trigger_id = "chapter2_intro"
one_shot = true
event_type = "Dialogue"
dialogue_path = "res://resources/dialogues/chapter2/chapter2_start.tres"

[node name="CollisionShape2D" type="CollisionShape2D" parent="Triggers/ChapterStartTrigger"]
shape = SubResource("RectangleShape2D_npc")

[node name="ExitToTraining" type="Area2D" parent="Triggers"]
position = Vector2(800, 50)
script = ExtResource("2_trigger")
trigger_id = "exit_to_training"
one_shot = false
event_type = "MapTransition"
target_map = "res://scenes/maps/chapter2/training_grounds.tscn"
spawn_point = "from_village"

[node name="CollisionShape2D" type="CollisionShape2D" parent="Triggers/ExitToTraining"]
shape = SubResource("RectangleShape2D_npc")

[node name="ExitToGuild" type="Area2D" parent="Triggers"]
position = Vector2(1550, 500)
script = ExtResource("2_trigger")
trigger_id = "exit_to_guild"
one_shot = false
event_type = "MapTransition"
target_map = "res://scenes/maps/chapter2/mercenary_guild.tscn"
spawn_point = "from_village"

[node name="CollisionShape2D" type="CollisionShape2D" parent="Triggers/ExitToGuild"]
shape = SubResource("RectangleShape2D_npc")

[node name="UI" type="CanvasLayer" parent="."]
layer = 10

[node name="MapNameLabel" type="Label" parent="UI"]
offset_left = 20.0
offset_top = 20.0
offset_right = 300.0
offset_bottom = 50.0
text = "마을 광장"
