[gd_scene load_steps=4 format=3 uid="uid://dark_knight_arena_map"]

[ext_resource type="Script" path="res://scripts/map/map_data.gd" id="1_mapdata"]
[ext_resource type="Script" path="res://scripts/events/event_trigger.gd" id="2_trigger"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_boss"]
size = Vector2(150, 150)

[node name="DarkKnightArena" type="Node2D"]

[node name="MapData" type="Node" parent="."]
script = ExtResource("1_mapdata")
map_id = "dark_knight_arena"
map_name = "어둠의 기사 투기장"
chapter = 3
map_width = 1200
map_height = 1000
map_type = "Boss"
connections = {"exit_south": {"map": "res://scenes/maps/chapter3/corrupted_shrine.tscn", "spawn": "from_boss"}}
entry_events = ["boss_encounter"]

[node name="Arena" type="ColorRect" parent="."]
offset_right = 1200.0
offset_bottom = 1000.0
color = Color(0.08, 0.05, 0.1, 1)

[node name="BossCircle" type="ColorRect" parent="."]
offset_left = 400.0
offset_top = 200.0
offset_right = 800.0
offset_bottom = 600.0
color = Color(0.15, 0.08, 0.18, 1)

[node name="Throne" type="ColorRect" parent="."]
offset_left = 500.0
offset_top = 100.0
offset_right = 700.0
offset_bottom = 250.0
color = Color(0.25, 0.1, 0.3, 1)

[node name="TorchLeft" type="ColorRect" parent="."]
offset_left = 100.0
offset_top = 300.0
offset_right = 150.0
offset_bottom = 400.0
color = Color(0.8, 0.4, 0.1, 1)

[node name="TorchRight" type="ColorRect" parent="."]
offset_left = 1050.0
offset_top = 300.0
offset_right = 1100.0
offset_bottom = 400.0
color = Color(0.8, 0.4, 0.1, 1)

[node name="DarkAura" type="ColorRect" parent="."]
offset_left = 300.0
offset_top = 100.0
offset_right = 900.0
offset_bottom = 700.0
color = Color(0.3, 0.0, 0.4, 0.2)

[node name="SpawnPoints" type="Node2D" parent="."]

[node name="default" type="Marker2D" parent="SpawnPoints"]
position = Vector2(600, 850)

[node name="from_shrine" type="Marker2D" parent="SpawnPoints"]
position = Vector2(600, 900)

[node name="BossSpawn" type="Node2D" parent="."]

[node name="DarkKnight" type="Marker2D" parent="BossSpawn"]
position = Vector2(600, 350)
metadata/enemy_id = "dark_knight"
metadata/is_boss = true

[node name="Triggers" type="Node2D" parent="."]

[node name="BossEncounter" type="Area2D" parent="Triggers"]
position = Vector2(600, 700)
script = ExtResource("2_trigger")
trigger_id = "boss_encounter_trigger"
one_shot = true
event_type = "Dialogue"
dialogue_path = "res://resources/dialogues/chapter3/boss_encounter.tres"

[node name="CollisionShape2D" type="CollisionShape2D" parent="Triggers/BossEncounter"]
shape = SubResource("RectangleShape2D_boss")

[node name="BossDefeated" type="Area2D" parent="Triggers"]
position = Vector2(600, 350)
script = ExtResource("2_trigger")
trigger_id = "boss_defeated"
one_shot = true
required_flags = ["dark_knight_defeated"]
event_type = "Dialogue"
dialogue_path = "res://resources/dialogues/chapter3/boss_victory.tres"

[node name="CollisionShape2D" type="CollisionShape2D" parent="Triggers/BossDefeated"]
shape = SubResource("RectangleShape2D_boss")

[node name="ChapterComplete" type="Area2D" parent="Triggers"]
position = Vector2(600, 350)
script = ExtResource("2_trigger")
trigger_id = "chapter3_complete"
one_shot = true
required_flags = ["dark_knight_defeated", "boss_dialogue_complete"]
event_type = "SetFlag"
flag_name = "first_boss_defeated"

[node name="CollisionShape2D" type="CollisionShape2D" parent="Triggers/ChapterComplete"]
shape = SubResource("RectangleShape2D_boss")

[node name="UI" type="CanvasLayer" parent="."]
layer = 10

[node name="MapNameLabel" type="Label" parent="UI"]
offset_left = 20.0
offset_top = 20.0
offset_right = 400.0
offset_bottom = 50.0
text = "어둠의 기사 투기장 - BOSS"

[node name="BossWarning" type="Label" parent="UI"]
offset_left = 400.0
offset_top = 100.0
offset_right = 800.0
offset_bottom = 150.0
text = "⚔ BOSS BATTLE ⚔"
horizontal_alignment = 1
modulate = Color(1, 0.3, 0.3, 1)
